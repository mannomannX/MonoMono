#!/bin/bash
# ==============================================================================
# MonoMono Update-Skript v2.1 (mit intelligenter PAT-Auth)
# ==============================================================================
CONFIG_FILE="$HOME/.monomono_config"

# --- 1. LADE KONFIGURATION & AUTHENTIFIZIERE ---
if [ -f "$CONFIG_FILE" ]; then
    source "$CONFIG_FILE"
    if [ -n "$MONOMONO_PAT" ]; then
        export GH_TOKEN=$MONOMONO_PAT
        echo "✔ Konfiguration und Token geladen."
    else
        echo "❌ Fehler: Kein PAT in der Konfiguration gefunden. Bitte führe 'monomono' zuerst aus." >&2
        exit 1
    fi
else
    echo "❌ Fehler: Keine Konfigurationsdatei gefunden. Bitte führe 'monomono' zuerst aus." >&2
    exit 1
fi

# --- 2. WORKFLOW STARTEN ---
if [ -z "$1" ]; then
  echo "❌ Fehler: Du musst den Pfad zum Fusions-Repo angeben." >&2
  echo "   Beispiel: monomono-update dein-name/dein-fusions-repo" >&2
  exit 1
fi
REPO_PATH=$1

echo "ℹ️ Starte den Update-Workflow für das Repo: $REPO_PATH"
gh workflow run sync.yml --repo "$REPO_PATH" || { echo "❌ Fehler beim Starten des Workflows."; exit 1; }

echo "✅ Befehl zum Aktualisieren gesendet. Verfolge den Fortschritt hier:"
echo "   https://github.com/$REPO_PATH/actions"